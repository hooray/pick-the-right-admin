
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{d as ne,a9 as oe,u as re,b1 as ue,n as ie,r as L,at as U,b2 as ce,p as fe,q as O,a as de,ao as h,J as pe,b3 as q,s as I,g as d,an as ve,j as p,w as x,f as o,c as R,F as Q,Q as A,e as v,h as me,l as C,i as G,x as he,a5 as xe,a1 as V,a2 as T,a7 as _e,b as ge,v as W,t as X}from"./index-D8kZ2dnq.js";import{_ as ye}from"./index.vue_vue_type_script_setup_true_lang-DqdzEeBY.js";import ke from"./index-DA0E4hRM.js";import{_ as be}from"./item.vue_vue_type_script_setup_true_lang-DF4NvPHa.js";const Re={class:"h-12 flex flex-shrink-0 items-center"},we={class:"h-full w-14 flex-center"},Se=["onKeydown"],Me={key:0,class:"h-full w-14 flex-center border-s"},Ie={class:"w-full flex justify-between px-4 py-3"},Ce={class:"flex gap-8"},Ve={class:"inline-flex items-center gap-1 text-xs"},Te={class:"inline-flex items-center gap-1 text-xs"},ze={key:0,class:"inline-flex items-center gap-1 text-xs"},Be=["data-index","onClick","onMouseover"],$e={class:"flex flex-1 flex-col gap-1 truncate border-s px-4 py-3"},Ne={class:"truncate text-start text-base font-bold"},Ee={key:1,class:"h-full flex-col-center py-6 text-secondary-foreground/50"},Fe={key:2,class:"h-full flex-col-center py-6 text-secondary-foreground/50"},Ke=ne({name:"NavSearchModal",__name:"search",props:{modelValue:{type:Boolean,default:!1},modelModifiers:{}},emits:["update:modelValue"],setup(Y){const _=oe(Y,"modelValue"),Z=ge(),w=re(),z=ue(),ee=ie(),i=L(""),K=U("searchInputRef"),{focused:te}=ce(K),B=L([]),n=L(-1),$=U("searchResultRef"),M=U("searchResultItemRef"),g=fe(()=>{let a=[];return a=B.value.filter(e=>{let s=!1;return i.value!==""&&(e.title&&(typeof e.title=="function"?e.title().includes(i.value)&&(s=!0):e.title.includes(i.value)&&(s=!0)),e.path.includes(i.value)&&(s=!0),z.getRouteMatchedByPath(e.path).some(l=>{var u,t,r,c;return typeof((u=l.meta)==null?void 0:u.title)=="function"?(t=l.meta)==null?void 0:t.title().includes(i.value):(c=(r=l.meta)==null?void 0:r.title)==null?void 0:c.includes(i.value)})&&(s=!0)),s}),a});O(()=>_.value,a=>{a?(i.value="",n.value=-1,h("up",N),h("down",E),h("enter",F),h("esc",e=>{w.settings.navSearch.enableHotkeys&&(e.preventDefault(),_.value=!1)})):(h.unbind("up",N),h.unbind("down",E),h.unbind("enter",F),h.unbind("esc"))}),O(()=>g.value,()=>{n.value=-1,H()}),de(()=>{se(),h("command+k, ctrl+k",a=>{w.settings.navSearch.enableHotkeys&&(a.preventDefault(),_.value=!0)})}),pe(()=>{h.unbind("command+k, ctrl+k")});function se(){B.value=[],ee.allMenus.forEach(a=>{P(a.children)})}function le(a){var s;let e=!0;return(s=a.children)!=null&&s.every(l=>{var u;return((u=l.meta)==null?void 0:u.menu)===!1})&&(e=!1),e}function P(a,e,s){a.forEach(l=>{var u,t,r,c,f,y,m;((u=l.meta)==null?void 0:u.menu)!==!1&&(l.children&&le(l)?P(l.children,q(e,l.path),(r=(t=l.meta)==null?void 0:t.icon)!=null?r:s):B.value.push({path:q(e,l.path),icon:(f=(c=l.meta)==null?void 0:c.icon)!=null?f:s,title:(y=l.meta)==null?void 0:y.title,link:(m=l.meta)==null?void 0:m.link}))})}function N(){g.value.length&&(n.value-=1,n.value<0&&(n.value=g.value.length-1),H())}function E(){g.value.length&&(n.value+=1,n.value>g.value.length-1&&(n.value=0),H())}function F(){var a,e;n.value!==-1&&((e=(a=M.value)==null?void 0:a.find(s=>Number.parseInt(s.dataset.index)===n.value))==null||e.click())}function H(){var a,e,s,l,u,t,r,c,f,y;if((l=(s=(e=(a=$.value)==null?void 0:a.areaRef)==null?void 0:e.ref)==null?void 0:s.el)!=null&&l.viewportElement){const m=$.value.areaRef.ref.el.viewportElement;let k=0;if(n.value!==-1){k=m.scrollTop;const b=(r=(t=(u=M.value)==null?void 0:u.find(D=>Number.parseInt(D.dataset.index)===n.value))==null?void 0:t.offsetTop)!=null?r:0,S=(y=(f=(c=M.value)==null?void 0:c.find(D=>Number.parseInt(D.dataset.index)===n.value))==null?void 0:f.clientHeight)!=null?y:0,j=m.scrollTop,J=m.clientHeight;b+S>j+J?k=b+S-J:b<=j&&(k=b-16)}m.scrollTo({top:k})}}function ae(a,e){e?window.open(e,"_blank"):Z.push(a),_.value=!1}return(a,e)=>{const s=me,l=ye,u=ve;return d(),I(u,{ref_key:"searchResultRef",ref:$,modelValue:_.value,"onUpdate:modelValue":e[3]||(e[3]=t=>_.value=t),border:"",footer:p(w).mode==="pc",closable:!1,class:"w-full lg-max-w-2xl","content-class":"flex flex-col p-0 min-h-auto","header-class":"p-0","footer-class":"p-0",onOpened:e[4]||(e[4]=t=>te.value=!0)},{header:x(()=>[o("div",Re,[o("div",we,[v(s,{name:"i-ri:search-line",class:"size-4 text-foreground/30"})]),he(o("input",{ref_key:"searchInputRef",ref:K,"onUpdate:modelValue":e[0]||(e[0]=t=>_e(i)?i.value=t:null),placeholder:"搜索页面，支持标题、URL模糊查询",class:"h-full w-full border-0 rounded-md bg-transparent text-base text-foreground focus-outline-none placeholder-foreground/30",onKeydown:[e[1]||(e[1]=V(T(t=>_.value=!1,["prevent"]),["esc"])),V(T(N,["prevent"]),["up"]),V(T(E,["prevent"]),["down"]),V(T(F,["prevent"]),["enter"])]},null,40,Se),[[xe,p(i)]]),p(w).mode==="mobile"?(d(),R("div",Me,[v(s,{name:"i-carbon:close",class:"size-4",onClick:e[2]||(e[2]=t=>_.value=!1)})])):C("",!0)])]),footer:x(()=>[o("div",Ie,[o("div",Ce,[o("div",Ve,[v(l,null,{default:x(()=>[v(s,{name:"i-ion:md-return-left",class:"size-4"})]),_:1}),e[5]||(e[5]=o("span",null,"访问",-1))]),o("div",Te,[v(l,null,{default:x(()=>[v(s,{name:"i-ant-design:caret-up-filled",class:"size-4"})]),_:1}),v(l,null,{default:x(()=>[v(s,{name:"i-ant-design:caret-down-filled",class:"size-4"})]),_:1}),e[6]||(e[6]=o("span",null,"切换",-1))])]),p(w).settings.navSearch.enableHotkeys?(d(),R("div",ze,[v(l,null,{default:x(()=>e[7]||(e[7]=[G(" ESC ",-1)])),_:1,__:[7]}),e[8]||(e[8]=o("span",null,"退出",-1))])):C("",!0)])]),default:x(()=>[o("div",null,[p(g).length>0?(d(!0),R(Q,{key:0},A(p(g),(t,r)=>{var c;return d(),R("div",{ref_for:!0,ref_key:"searchResultItemRef",ref:M,key:t.path,class:"p-4","data-index":r,onClick:f=>ae(t.path,t.link),onMouseover:f=>n.value=r},[o("a",{class:W(["flex cursor-pointer items-center border rounded-lg",{"-mt-4":r!==0,"bg-accent":r===p(n)}])},[t.icon?(d(),I(s,{key:0,name:t.icon,class:W(["size-5 basis-16 transition",{"scale-120 text-primary":r===p(n)}])},null,8,["name","class"])):C("",!0),o("div",$e,[o("div",Ne,X((c=typeof t.title=="function"?t.title():t.title)!=null?c:"[ 无标题 ]"),1),p(z).getRouteMatchedByPath(t.path).length?(d(),I(ke,{key:0,class:"truncate"},{default:x(()=>[(d(!0),R(Q,null,A(p(z).getRouteMatchedByPath(t.path),(f,y)=>(d(),I(be,{key:y,class:"text-xs"},{default:x(()=>{var m,k,b,S;return[G(X((S=typeof((m=f.meta)==null?void 0:m.title)=="function"?(k=f.meta)==null?void 0:k.title():(b=f.meta)==null?void 0:b.title)!=null?S:"[ 无标题 ]"),1)]}),_:2},1024))),128))]),_:2},1024)):C("",!0)])],2)],40,Be)}),128)):p(i)===""?(d(),R("div",Ee,[v(s,{name:"i-tabler:mood-smile",class:"size-10"}),e[9]||(e[9]=o("p",{class:"m-2 text-base"}," 输入你要搜索的导航 ",-1))])):(d(),R("div",Fe,[v(s,{name:"i-tabler:mood-empty",class:"size-10"}),e[10]||(e[10]=o("p",{class:"m-2 text-base"}," 没有找到你想要的 ",-1))]))])]),_:1},8,["modelValue","footer"])}}});export{Ke as _};
